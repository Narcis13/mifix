---
phase: 01-foundation-setup
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - packages/client/package.json
  - packages/client/vite.config.ts
  - packages/client/src/index.css
  - packages/client/components.json
  - packages/client/src/lib/utils.ts
  - packages/client/src/components/ui/*
  - packages/shared/package.json
  - packages/shared/src/types/index.ts
  - packages/shared/src/money.ts
  - packages/shared/src/index.ts
autonomous: true

must_haves:
  truths:
    - "shadcn/ui Button component renders correctly"
    - "Tailwind CSS utilities work in client"
    - "Money class handles decimal precision correctly (0.1 + 0.2 = 0.3)"
    - "Shared types can be imported in both client and server"
  artifacts:
    - path: "packages/client/components.json"
      provides: "shadcn/ui configuration"
    - path: "packages/client/src/components/ui/button.tsx"
      provides: "First shadcn component"
    - path: "packages/shared/src/money.ts"
      provides: "Decimal.js wrapper for financial calculations"
      exports: ["Money"]
      min_lines: 40
    - path: "packages/shared/src/types/index.ts"
      provides: "Shared TypeScript types"
      min_lines: 30
  key_links:
    - from: "packages/client/src/index.css"
      to: "tailwindcss"
      via: "@import"
      pattern: "@import.*tailwindcss"
    - from: "packages/shared/src/money.ts"
      to: "decimal.js"
      via: "import"
      pattern: "import.*Decimal.*decimal.js"
---

<objective>
Set up shadcn/ui with Tailwind CSS v4 in the client, and create shared types plus Money utility class for financial calculations.

Purpose: Establish the UI foundation and shared code that enables consistent styling and type-safe financial operations across the application.

Output: Working shadcn/ui with at least one component, Tailwind CSS styling, shared types for API responses, and Money class that correctly handles decimal arithmetic.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-setup/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install and configure shadcn/ui with Tailwind v4</name>
  <files>
    packages/client/package.json
    packages/client/vite.config.ts
    packages/client/src/index.css
    packages/client/components.json
    packages/client/src/lib/utils.ts
    packages/client/tsconfig.json
  </files>
  <action>
1. Install Tailwind CSS and Vite plugin in client:
   ```bash
   cd packages/client
   bun add tailwindcss @tailwindcss/vite
   bun add -D @types/node
   ```

2. Update `packages/client/vite.config.ts` to add Tailwind plugin and path alias:
   ```typescript
   import path from "path";
   import tailwindcss from "@tailwindcss/vite";
   import react from "@vitejs/plugin-react";
   import { defineConfig } from "vite";

   export default defineConfig({
     plugins: [react(), tailwindcss()],
     resolve: {
       alias: {
         "@": path.resolve(__dirname, "./src"),
       },
     },
     server: {
       proxy: {
         "/api": {
           target: "http://localhost:3000",
           changeOrigin: true,
         },
       },
     },
   });
   ```

3. Update `packages/client/tsconfig.json` to add path alias:
   ```json
   {
     "compilerOptions": {
       "baseUrl": ".",
       "paths": {
         "@/*": ["./src/*"]
       }
     }
   }
   ```

4. Initialize shadcn/ui:
   ```bash
   cd packages/client
   bunx shadcn@latest init
   ```
   When prompted:
   - Style: New York
   - Base color: Neutral (or Slate)
   - CSS variables: Yes
   - Use React Server Components: No (this is Vite, not Next.js)

   This creates:
   - components.json configuration
   - src/lib/utils.ts with cn() helper
   - Updates to src/index.css with Tailwind directives and CSS variables

5. Add a basic component to verify setup works:
   ```bash
   bunx shadcn@latest add button
   ```
   This creates `src/components/ui/button.tsx`

6. Verify Tailwind v4 setup in src/index.css - it should have:
   ```css
   @import "tailwindcss";
   ```
   NOT the old `@tailwind base; @tailwind components; @tailwind utilities;`
  </action>
  <verify>
- `cat packages/client/components.json` shows shadcn configuration
- `ls packages/client/src/components/ui/` shows button.tsx
- `cat packages/client/src/index.css | head -5` shows @import "tailwindcss"
- `cat packages/client/vite.config.ts | grep tailwindcss` shows plugin configured
  </verify>
  <done>
shadcn/ui initialized with Tailwind v4. Button component installed. Path aliases configured for clean imports.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Money utility class with decimal.js</name>
  <files>
    packages/shared/package.json
    packages/shared/src/money.ts
  </files>
  <action>
1. Install decimal.js in shared package:
   ```bash
   cd packages/shared
   bun add decimal.js
   ```

2. Create `packages/shared/src/money.ts`:
   ```typescript
   import Decimal from "decimal.js";

   // Configure decimal.js for financial calculations
   Decimal.set({
     precision: 20,
     rounding: Decimal.ROUND_HALF_UP,
   });

   /**
    * Money class wraps decimal.js for safe financial calculations.
    *
    * Usage:
    * - Create from string (preferred): new Money("100.50")
    * - Create from database: Money.fromDb("100.50")
    * - Arithmetic: money.plus(other), money.minus(other), money.times(n), money.dividedBy(n)
    * - Output: money.toDbString() for database, money.toDisplay() for UI
    *
    * NEVER use JavaScript numbers for monetary calculations!
    */
   export class Money {
     private value: Decimal;

     constructor(value: string | number | Decimal) {
       // Always convert numbers to string first to avoid precision loss
       this.value = new Decimal(
         typeof value === "number" ? value.toString() : value
       );
     }

     // Arithmetic operations - return new Money instances (immutable)
     plus(other: Money | string | number): Money {
       const otherValue = other instanceof Money ? other.value : new Decimal(other);
       return new Money(this.value.plus(otherValue));
     }

     minus(other: Money | string | number): Money {
       const otherValue = other instanceof Money ? other.value : new Decimal(other);
       return new Money(this.value.minus(otherValue));
     }

     times(multiplier: number | string): Money {
       return new Money(this.value.times(new Decimal(multiplier)));
     }

     dividedBy(divisor: number | string): Money {
       return new Money(this.value.dividedBy(new Decimal(divisor)));
     }

     // Output methods
     toDbString(): string {
       return this.value.toFixed(2);
     }

     toDisplay(decimals: number = 2): string {
       return this.value.toFixed(decimals);
     }

     toNumber(): number {
       return this.value.toNumber();
     }

     toJSON(): string {
       return this.toDbString();
     }

     // Comparison methods
     equals(other: Money): boolean {
       return this.value.equals(other.value);
     }

     greaterThan(other: Money): boolean {
       return this.value.greaterThan(other.value);
     }

     lessThan(other: Money): boolean {
       return this.value.lessThan(other.value);
     }

     greaterThanOrEqualTo(other: Money): boolean {
       return this.value.greaterThanOrEqualTo(other.value);
     }

     lessThanOrEqualTo(other: Money): boolean {
       return this.value.lessThanOrEqualTo(other.value);
     }

     isZero(): boolean {
       return this.value.isZero();
     }

     isPositive(): boolean {
       return this.value.isPositive();
     }

     isNegative(): boolean {
       return this.value.isNegative();
     }

     // Static factory methods
     static fromDb(dbValue: string): Money {
       return new Money(dbValue);
     }

     static zero(): Money {
       return new Money("0");
     }

     // Calculate monthly depreciation (linear method)
     static calculateMonthlyDepreciation(
       purchaseValue: Money,
       usefulLifeMonths: number
     ): Money {
       return purchaseValue.dividedBy(usefulLifeMonths);
     }
   }
   ```
  </action>
  <verify>
Test the Money class handles precision correctly:
```bash
cd packages/shared
bun -e "
const { Money } = require('./src/money.ts');
const a = new Money('0.1');
const b = new Money('0.2');
const result = a.plus(b);
console.log('0.1 + 0.2 =', result.toDisplay());
console.log('Expected: 0.30');
console.log('Test passed:', result.toDisplay() === '0.30');
"
```
Should output "0.30" (not 0.30000000000000004)
  </verify>
  <done>
Money utility class created with decimal.js. Handles all arithmetic operations with correct precision. Static factory methods for database values.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create shared types for API and entities</name>
  <files>
    packages/shared/src/types/index.ts
    packages/shared/src/index.ts
  </files>
  <action>
1. Create `packages/shared/src/types/index.ts` with types from spec.md section 2.3:

```typescript
// ═══════════════════════════════════════════════════════════════
// ENUMERATIONS
// ═══════════════════════════════════════════════════════════════

export type MetodaAmortizare = "liniara" | "degresiva" | "accelerata";
export type StareMijlocFix = "activ" | "conservare" | "casat" | "transferat" | "vandut";
export type TipTranzactie = "intrare" | "transfer" | "casare" | "declasare" | "reevaluare" | "modernizare" | "iesire";
export type TipCont = "activ" | "pasiv" | "bifunctional";

// ═══════════════════════════════════════════════════════════════
// ENTITY INTERFACES
// Note: Monetary values are strings to preserve decimal precision
// ═══════════════════════════════════════════════════════════════

export interface Clasificare {
  cod: string;
  denumire: string;
  grupa: string;
  durataNormalaMin: number;
  durataNormalaMax: number;
  cotaAmortizare?: string; // decimal as string
}

export interface Gestiune {
  id: number;
  cod: string;
  denumire: string;
  responsabil?: string;
  activ: boolean;
  createdAt?: string;
  updatedAt?: string;
}

export interface LocFolosinta {
  id: number;
  gestiuneId: number;
  cod: string;
  denumire: string;
  activ: boolean;
  // Populated relations
  gestiune?: Gestiune;
}

export interface SursaFinantare {
  id: number;
  cod: string;
  denumire: string;
  activ: boolean;
}

export interface Cont {
  id: number;
  simbol: string;
  denumire: string;
  tip: TipCont;
  amortizabil: boolean;
  contAmortizare?: string;
  activ: boolean;
}

export interface MijlocFix {
  id: number;
  numarInventar: string;
  denumire: string;
  descriere?: string;

  // Classification
  clasificareCod: string;
  clasificare?: Clasificare;

  // Location
  gestiuneId: number;
  gestiune?: Gestiune;
  locFolosintaId?: number;
  locFolosinta?: LocFolosinta;

  // Financing
  sursaFinantareId?: number;
  sursaFinantare?: SursaFinantare;
  contId: number;
  cont?: Cont;

  // Values (strings for decimal precision)
  valoareInventar: string;
  valoareAmortizata: string;
  valoareRamasa: string;

  // Dates (ISO strings)
  dataAchizitie: string;
  dataPIF: string;
  dataStartAmortizare?: string;
  dataFinalAmortizare?: string;

  // Depreciation
  durataNormala: number; // months
  metodaAmortizare: MetodaAmortizare;
  amortizabil: boolean;

  // Documents
  documentAchizitie?: string;
  nrDocumentAchizitie?: string;
  dataDocumentAchizitie?: string;
  furnizor?: string;

  // Status
  stare: StareMijlocFix;

  createdAt: string;
  updatedAt: string;
}

export interface Tranzactie {
  id: number;
  mijlocFixId: number;
  mijlocFix?: MijlocFix;
  tip: TipTranzactie;
  dataOperare: string;
  dataDocument?: string;
  nrDocument?: string;
  tipDocument?: string;
  gestiuneSursaId?: number;
  gestiuneDestinatieId?: number;
  locFolosintaSursaId?: number;
  locFolosintaDestinatieId?: number;
  valoareOperatie?: string;
  detalii?: Record<string, unknown>;
  observatii?: string;
  userId?: number;
  createdAt: string;
}

export interface Amortizare {
  id: number;
  mijlocFixId: number;
  mijlocFix?: MijlocFix;
  luna: number;
  an: number;
  valoareLunara: string;
  valoareCumulata: string;
  valoareRamasa: string;
  procesat: boolean;
  dataGenerare: string;
}

// ═══════════════════════════════════════════════════════════════
// API RESPONSE TYPES
// ═══════════════════════════════════════════════════════════════

export interface ApiResponse<T = unknown> {
  success: boolean;
  data?: T;
  message?: string;
  errors?: Record<string, string[]>;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  pageSize: number;
  totalPages: number;
}
```

2. Update `packages/shared/src/index.ts` to export everything:
```typescript
export * from "./types/index";
export { Money } from "./money";
```

3. Verify exports compile:
```bash
cd packages/shared
bunx tsc --noEmit
```
  </action>
  <verify>
- `cat packages/shared/src/index.ts` shows exports for types and Money
- `cat packages/shared/src/types/index.ts | grep "interface"` shows all entity interfaces
- Compilation passes: `cd packages/shared && bunx tsc --noEmit`
  </verify>
  <done>
Shared types created for all entities (Gestiune, MijlocFix, Tranzactie, etc.) and API responses. Money class exported. All monetary values typed as strings for precision.
  </done>
</task>

</tasks>

<verification>
1. `bun run --cwd packages/client dev` - Vite starts without errors
2. Import Button component and it renders with Tailwind styles
3. Money precision test: `new Money("0.1").plus("0.2").toDisplay() === "0.30"`
4. Shared types can be imported: `import { MijlocFix, Money } from "shared"`
</verification>

<success_criteria>
- shadcn/ui initialized with Tailwind v4
- At least Button component installed and working
- Vite proxy configured for /api
- Path alias @ configured
- Money class correctly handles 0.1 + 0.2 = 0.30
- All entity types defined (Gestiune, MijlocFix, etc.)
- API response types defined
- Shared package exports both types and Money
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-setup/01-03-SUMMARY.md`
</output>
