---
phase: 06-rapoarte-autentificare
plan: 04
type: execute
wave: 3
depends_on: ["06-02", "06-03"]
files_modified:
  - packages/client/package.json
  - packages/client/src/index.css
  - packages/client/src/components/rapoarte/ReportFilters.tsx
  - packages/client/src/components/rapoarte/PrintLayout.tsx
  - packages/client/src/components/rapoarte/FisaMijlocFix.tsx
  - packages/client/src/components/rapoarte/BalantaVerificare.tsx
  - packages/client/src/components/rapoarte/JurnalActe.tsx
  - packages/client/src/components/rapoarte/SituatieAmortizare.tsx
  - packages/client/src/pages/Rapoarte.tsx
  - packages/client/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "User can view and print Fisa Mijlocului Fix for any asset"
    - "User can view and print Balanta de Verificare grouped by gestiune"
    - "User can view and print Jurnal Acte filtered by date range"
    - "User can view and print Situatie Amortizare for any month"
    - "All reports can be filtered by gestiune and period"
    - "Printed reports are properly formatted for A4 paper"
  artifacts:
    - path: "packages/client/src/pages/Rapoarte.tsx"
      provides: "Reports dashboard page"
      exports: ["RapoartePage"]
    - path: "packages/client/src/components/rapoarte/FisaMijlocFix.tsx"
      provides: "Asset card report component"
      exports: ["FisaMijlocFixReport"]
    - path: "packages/client/src/components/rapoarte/BalantaVerificare.tsx"
      provides: "Balance verification report component"
      exports: ["BalantaVerificareReport"]
  key_links:
    - from: "packages/client/src/components/rapoarte/*.tsx"
      to: "/api/rapoarte/*"
      via: "fetch calls"
      pattern: "fetch.*api/rapoarte"
    - from: "packages/client/src/components/rapoarte/*.tsx"
      to: "useReactToPrint"
      via: "print hook"
      pattern: "useReactToPrint"
---

<objective>
Create report UI components with printing capability: reports dashboard, four report views (Fisa, Balanta, Jurnal, Situatie), shared filter component, and print layout with CSS print styles.

Purpose: Complete RAP-01 through RAP-05 with user-facing report views and browser printing
Output: Users can generate, view, and print all four accounting compliance reports
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-rapoarte-autentificare/06-RESEARCH.md
@.planning/phases/06-rapoarte-autentificare/06-02-SUMMARY.md
@.planning/phases/06-rapoarte-autentificare/06-03-SUMMARY.md

# Existing UI patterns
@packages/client/src/pages/MijlocFixDetail.tsx
@packages/client/src/pages/Amortizare.tsx
@packages/client/src/components/mijloace-fixe/MijlocFixFilters.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-to-print and add CSS print styles</name>
  <files>
    packages/client/package.json
    packages/client/src/index.css
  </files>
  <action>
Install react-to-print:
```bash
cd packages/client && bun add react-to-print
```

Add CSS print styles to index.css (at the end of file):

```css
/* Print styles for reports */
@media print {
  /* Hide non-printable elements */
  .no-print,
  nav,
  .print-hide {
    display: none !important;
  }

  /* Show print-only elements */
  .print-only {
    display: block !important;
  }

  /* Reset backgrounds for printing */
  body {
    background: white !important;
    color: black !important;
    font-size: 12pt;
  }

  /* Container resets */
  .container {
    max-width: none !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Table styling for reports */
  table {
    border-collapse: collapse;
    width: 100%;
  }

  th, td {
    border: 1px solid #000;
    padding: 4px 8px;
    text-align: left;
  }

  th {
    background-color: #f0f0f0 !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Prevent page breaks inside rows */
  tr {
    page-break-inside: avoid;
  }

  /* Page settings */
  @page {
    size: A4;
    margin: 15mm;
  }

  /* Report header styling */
  .print-header {
    text-align: center;
    border-bottom: 2px solid #000;
    padding-bottom: 10px;
    margin-bottom: 20px;
  }

  .print-header h1 {
    font-size: 16pt;
    margin: 0;
  }

  .print-header .subtitle {
    font-size: 12pt;
    color: #333;
  }

  .print-header .date {
    font-size: 10pt;
    color: #666;
  }
}
```
  </action>
  <verify>
- react-to-print in package.json dependencies
- CSS print styles added to index.css
- Build succeeds: `cd packages/client && bun run build`
  </verify>
  <done>react-to-print installed and CSS print media queries configured</done>
</task>

<task type="auto">
  <name>Task 2: Create shared report components and Rapoarte page</name>
  <files>
    packages/client/src/components/rapoarte/ReportFilters.tsx
    packages/client/src/components/rapoarte/PrintLayout.tsx
    packages/client/src/pages/Rapoarte.tsx
    packages/client/src/main.tsx
  </files>
  <action>
Create components/rapoarte/ReportFilters.tsx:
- Shared filter component for reports
- Props: onFilter callback, showPeriod (boolean), showGestiune (boolean), showClasificare (boolean)
- Date inputs for dataStart/dataEnd (when showPeriod)
- Select for gestiune (fetch from /api/gestiuni, when showGestiune)
- Select for clasificare (when showClasificare, optional)
- "Genereaza Raport" button
- Use shadcn/ui: Card, Label, Input (type="date"), Select, Button
- Return filter state via callback

Create components/rapoarte/PrintLayout.tsx:
- Props: children, title, subtitle?, generatedDate (default: now)
- Wrapper div with className="print-layout"
- Header div with className="print-header" containing:
  - h1 with title
  - subtitle if provided (p with className="subtitle")
  - Generated date (p with className="date")
- Content div for children

Create pages/Rapoarte.tsx:
- Dashboard page with four report cards
- Each card: title, description, link to report sub-route
- Use Card, CardHeader, CardTitle, CardDescription, Button
- Report options:
  1. Fisa Mijlocului Fix - "Raport complet pentru un mijloc fix"
  2. Balanta de Verificare - "Situatie cantitativ-valorica pe gestiuni"
  3. Jurnal Acte Operate - "Istoric operatiuni pe perioada"
  4. Situatie Amortizare - "Amortizari calculate pe luna"
- Each card has a link/button to its report route

Update main.tsx:
- Import RapoartePage
- Add routes:
  ```
  {
    path: "rapoarte",
    children: [
      { index: true, element: <RapoartePage /> },
      { path: "fisa", element: <FisaMijlocFixPage /> },
      { path: "balanta", element: <BalantaVerificarePage /> },
      { path: "jurnal", element: <JurnalActePage /> },
      { path: "amortizare", element: <SituatieAmortizarePage /> },
    ],
  }
  ```
- Import components as needed (placeholder initially, implement in next task)

For now, create placeholder page components that just render "In dezvoltare..."
  </action>
  <verify>
- Navigate to /rapoarte - shows dashboard with 4 report cards
- Click each card - navigates to sub-route (placeholder for now)
- "Rapoarte" link visible in navigation
  </verify>
  <done>Rapoarte dashboard page created with navigation to 4 report types</done>
</task>

<task type="auto">
  <name>Task 3: Create report view components with printing</name>
  <files>
    packages/client/src/components/rapoarte/FisaMijlocFix.tsx
    packages/client/src/components/rapoarte/BalantaVerificare.tsx
    packages/client/src/components/rapoarte/JurnalActe.tsx
    packages/client/src/components/rapoarte/SituatieAmortizare.tsx
    packages/client/src/pages/Rapoarte.tsx
  </files>
  <action>
Create components/rapoarte/FisaMijlocFix.tsx (RAP-01):
- Accept mijlocFixId as prop or URL param
- Asset selector: Input to enter inventory number OR dropdown
- Fetch /api/rapoarte/fisa/:id on selection
- Display: Asset info sections (Identificare, Financiar, Amortizare)
- Transaction history table
- Depreciation history table
- Print button using useReactToPrint
- Wrap printable content in PrintLayout with title "Fisa Mijlocului Fix"
- Use ref for print target

Create components/rapoarte/BalantaVerificare.tsx (RAP-02):
- Filters: stare (activ by default)
- Fetch /api/rapoarte/balanta with filters
- Display table: Gestiune, Nr. Active, Valoare Inventar, Amortizat, Ramasa
- Totals row at bottom
- Print button
- PrintLayout with title "Balanta de Verificare Cantitativ-Valorica"

Create components/rapoarte/JurnalActe.tsx (RAP-03):
- Filters: dataStart, dataEnd (required), gestiuneId (optional), tip (optional)
- Default period: current month
- Fetch /api/rapoarte/jurnal with filters
- Display table: Data, Nr. Inventar, Denumire, Tip Operatie, Document, Sursa, Destinatie, Valoare
- Print button
- PrintLayout with title "Jurnal Acte Operate"

Create components/rapoarte/SituatieAmortizare.tsx (RAP-04):
- Filters: an, luna (required, default current), gestiuneId (optional)
- Use Select for month (1-12 with Romanian names), Input for year
- Fetch /api/rapoarte/amortizare with filters
- Display table: Nr. Inventar, Denumire, Gestiune, Clasificare, Val. Inventar, Amortizare Lunara, Cumulat, Ramasa
- Totals row
- Print button
- PrintLayout with title "Situatie Amortizare Lunara"

Pattern for all report components:
- useState for filter state
- useState for data (fetched from API)
- useState for loading/error
- useRef for print content
- useReactToPrint hook with:
  - contentRef pointing to printable div
  - documentTitle set appropriately
  - pageStyle with @page settings
- Button variant="outline" with Printer icon from lucide-react
- Loading state: show skeleton or spinner
- Error state: show error message
- Format monetary values with Money class or toFixed(2)
- Format dates in Romanian locale (toLocaleDateString('ro-RO'))

Update pages/Rapoarte.tsx:
- Replace placeholder routes with actual components
- Create wrapper pages (FisaMijlocFixPage, etc.) that render the report components
  </action>
  <verify>
- Navigate to /rapoarte/balanta - shows balance report with data
- Click print - opens print dialog with formatted content
- Navigate to /rapoarte/jurnal - set date range - shows transactions
- Navigate to /rapoarte/amortizare - select month - shows depreciation
- Navigate to /rapoarte/fisa - select asset - shows complete asset info
- All reports print correctly with proper formatting
  </verify>
  <done>
- FisaMijlocFix shows complete asset data with print
- BalantaVerificare shows gestiune totals with print
- JurnalActe shows filtered transactions with print
- SituatieAmortizare shows monthly depreciation with print
- All reports have filter controls
- Print output is A4 formatted
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete authentication and reporting system:
- Login/logout functionality
- Session persistence across refresh
- Four accounting reports (Fisa, Balanta, Jurnal, Situatie)
- Report filtering and printing
  </what-built>
  <how-to-verify>
1. Authentication Flow:
   - Open http://localhost:5173 (should redirect to login)
   - Login with admin/admin123
   - Verify you can navigate to all pages
   - Refresh browser - should stay logged in
   - Click "Iesire" - should log out and redirect to login

2. Reports Dashboard:
   - Navigate to /rapoarte
   - Verify 4 report cards are visible

3. Fisa Mijlocului Fix:
   - Go to /rapoarte/fisa
   - Select or enter an asset
   - Verify complete asset info displays
   - Click print - verify A4 layout in print preview

4. Balanta de Verificare:
   - Go to /rapoarte/balanta
   - Verify table with gestiuni and totals
   - Click print - verify layout

5. Jurnal Acte Operate:
   - Go to /rapoarte/jurnal
   - Set a date range
   - Verify transactions display
   - Click print - verify layout

6. Situatie Amortizare:
   - Go to /rapoarte/amortizare
   - Select a month/year with data
   - Verify depreciation records display
   - Click print - verify layout

7. Authentication Required:
   - Logout
   - Try to directly access /rapoarte - should redirect to login
  </how-to-verify>
  <resume-signal>Type "approved" if all verification steps pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Start server and client
2. Test complete auth flow (login, refresh, logout)
3. Navigate to each report page
4. Generate reports with filters
5. Print each report - verify formatting
6. Verify unauthenticated access redirects to login
</verification>

<success_criteria>
- [ ] react-to-print installed and working
- [ ] CSS print styles produce A4-formatted output
- [ ] Rapoarte dashboard shows all 4 report types
- [ ] Fisa Mijlocului Fix displays complete asset with history
- [ ] Balanta de Verificare displays grouped totals
- [ ] Jurnal Acte shows filtered transactions
- [ ] Situatie Amortizare shows monthly depreciation
- [ ] All reports have working print functionality
- [ ] All reports have filter controls
- [ ] Human verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/06-rapoarte-autentificare/06-04-SUMMARY.md`
</output>
