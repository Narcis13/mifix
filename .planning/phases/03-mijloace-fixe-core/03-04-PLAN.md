---
phase: 03-mijloace-fixe-core
plan: 04
type: execute
wave: 3
depends_on: ["03-02", "03-03"]
files_modified:
  - packages/client/src/pages/MijloaceFixe.tsx
  - packages/client/src/components/mijloace-fixe/MijlocFixColumns.tsx
  - packages/client/src/main.tsx
  - packages/client/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "User can see list of assets at /mijloace-fixe"
    - "User can filter list by gestiune, stare, and text search"
    - "User can click row to navigate to detail page"
    - "Empty state shows when no assets exist"
  artifacts:
    - path: "packages/client/src/pages/MijloaceFixe.tsx"
      provides: "Asset list page with filtering"
      min_lines: 100
    - path: "packages/client/src/components/mijloace-fixe/MijlocFixColumns.tsx"
      provides: "Column definitions for asset table"
  key_links:
    - from: "MijloaceFixe.tsx"
      to: "/mijloace-fixe"
      via: "api.get with filter params"
      pattern: "api\\.get.*mijloace-fixe"
    - from: "main.tsx"
      to: "MijloaceFixePage"
      via: "route definition"
      pattern: "path.*mijloace-fixe"
---

<objective>
Create the MijloaceFixe list page with DataTable, filtering, and navigation to detail/create pages.

Purpose: Implements MF-02 (Listare mijloace fixe cu filtrare) - the main asset management view.
Output: Functional asset list page with search, filters, and row click navigation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-mijloace-fixe-core/03-CONTEXT.md
@.planning/phases/03-mijloace-fixe-core/03-RESEARCH.md
@packages/client/src/pages/Gestiuni.tsx
@packages/client/src/pages/Clasificari.tsx
@packages/client/src/components/data-table/DataTable.tsx
@packages/client/src/main.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MijlocFix column definitions and list page</name>
  <files>
    packages/client/src/components/mijloace-fixe/MijlocFixColumns.tsx
    packages/client/src/pages/MijloaceFixe.tsx
  </files>
  <action>
**1. Create MijlocFixColumns.tsx** at packages/client/src/components/mijloace-fixe/:

Define column definitions for the DataTable:

```typescript
import type { ColumnDef } from "@tanstack/react-table";
import type { MijlocFix } from "shared";
import { StareBadge } from "./StareBadge";

export const mijlocFixColumns: ColumnDef<MijlocFix>[] = [
  {
    accessorKey: "numarInventar",
    header: "Nr. Inventar",
    cell: ({ row }) => (
      <span className="font-mono font-medium">
        {row.getValue("numarInventar")}
      </span>
    ),
  },
  {
    accessorKey: "denumire",
    header: "Denumire",
    cell: ({ row }) => (
      <span className="max-w-[300px] truncate block">
        {row.getValue("denumire")}
      </span>
    ),
  },
  {
    accessorKey: "clasificareCod",
    header: "Clasificare",
    cell: ({ row }) => (
      <span className="font-mono text-sm">
        {row.getValue("clasificareCod")}
      </span>
    ),
  },
  {
    accessorKey: "gestiune",
    header: "Gestiune",
    cell: ({ row }) => {
      const gestiune = row.original.gestiune;
      return gestiune ? `${gestiune.cod} - ${gestiune.denumire}` : "-";
    },
  },
  {
    accessorKey: "valoareInventar",
    header: "Valoare",
    cell: ({ row }) => {
      const value = row.getValue("valoareInventar") as string;
      return (
        <span className="text-right font-mono">
          {parseFloat(value).toLocaleString("ro-RO", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2,
          })} RON
        </span>
      );
    },
  },
  {
    accessorKey: "stare",
    header: "Stare",
    cell: ({ row }) => <StareBadge stare={row.getValue("stare")} />,
  },
];
```

**2. Create MijloaceFixe.tsx** list page at packages/client/src/pages/:

Follow pattern from Clasificari.tsx (pagination + filtering) combined with Gestiuni.tsx (DataTable usage).

Key elements:
- State: filters, gestiuni list, assets (paginated), isLoading
- Fetch gestiuni for filter dropdown on mount
- Fetch assets when filters change (with debounced search)
- Use MijlocFixFilters component
- Use DataTable with mijlocFixColumns
- "Adauga Mijloc Fix" button navigates to /mijloace-fixe/nou
- Click on row navigates to /mijloace-fixe/{id}

Implementation:

```typescript
import { useState, useEffect, useCallback } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import type { MijlocFix, Gestiune, PaginatedResponse } from "shared";
import { api } from "@/lib/api";
import { DataTable } from "@/components/data-table/DataTable";
import { MijlocFixFilters } from "@/components/mijloace-fixe/MijlocFixFilters";
import { mijlocFixColumns } from "@/components/mijloace-fixe/MijlocFixColumns";
import { Button } from "@/components/ui/button";
import { Plus } from "lucide-react";
import { useDebounce } from "@/hooks/useDebounce";

export function MijloaceFixePage() {
  const navigate = useNavigate();
  const [searchParams, setSearchParams] = useSearchParams();

  // Initialize filters from URL params
  const [filters, setFilters] = useState({
    search: searchParams.get("search") || "",
    gestiuneId: searchParams.get("gestiuneId")
      ? parseInt(searchParams.get("gestiuneId")!)
      : undefined,
    stare: searchParams.get("stare") || undefined,
  });

  const [gestiuni, setGestiuni] = useState<Gestiune[]>([]);
  const [assets, setAssets] = useState<MijlocFix[]>([]);
  const [total, setTotal] = useState(0);
  const [page, setPage] = useState(1);
  const [isLoading, setIsLoading] = useState(true);

  const debouncedSearch = useDebounce(filters.search, 300);

  // Fetch gestiuni for filter dropdown
  useEffect(() => {
    api.get<Gestiune[]>("/gestiuni").then((res) => {
      if (res.success && res.data) {
        setGestiuni(res.data);
      }
    });
  }, []);

  // Fetch assets when filters change
  const fetchAssets = useCallback(async () => {
    setIsLoading(true);

    const params = new URLSearchParams();
    if (debouncedSearch) params.set("search", debouncedSearch);
    if (filters.gestiuneId) params.set("gestiuneId", filters.gestiuneId.toString());
    if (filters.stare) params.set("stare", filters.stare);
    params.set("page", page.toString());
    params.set("pageSize", "20");

    const res = await api.get<PaginatedResponse<MijlocFix>>(
      `/mijloace-fixe?${params.toString()}`
    );

    if (res.success && res.data) {
      setAssets(res.data.items);
      setTotal(res.data.total);
    }
    setIsLoading(false);
  }, [debouncedSearch, filters.gestiuneId, filters.stare, page]);

  useEffect(() => {
    fetchAssets();
  }, [fetchAssets]);

  // Sync filters to URL
  useEffect(() => {
    const params = new URLSearchParams();
    if (filters.search) params.set("search", filters.search);
    if (filters.gestiuneId) params.set("gestiuneId", filters.gestiuneId.toString());
    if (filters.stare) params.set("stare", filters.stare);
    setSearchParams(params, { replace: true });
  }, [filters, setSearchParams]);

  const handleRowClick = (asset: MijlocFix) => {
    navigate(`/mijloace-fixe/${asset.id}`);
  };

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Mijloace Fixe</h1>
          <p className="text-muted-foreground">
            {total} active inregistrate
          </p>
        </div>
        <Button onClick={() => navigate("/mijloace-fixe/nou")}>
          <Plus className="mr-2 h-4 w-4" />
          Adauga Mijloc Fix
        </Button>
      </div>

      <MijlocFixFilters
        gestiuni={gestiuni}
        filters={filters}
        onFiltersChange={setFilters}
      />

      <DataTable
        columns={mijlocFixColumns}
        data={assets}
        isLoading={isLoading}
        emptyMessage="Nu exista mijloace fixe. Adaugati primul mijloc fix."
        onRowClick={handleRowClick}
      />

      {/* TODO: Add pagination controls if needed */}
    </div>
  );
}
```

IMPORTANT: Update DataTable component to support onRowClick prop if it doesn't already. Add:
```typescript
interface DataTableProps<TData, TValue> {
  // ... existing props
  onRowClick?: (row: TData) => void;
}
```

And in the TableRow:
```tsx
<TableRow
  key={row.id}
  onClick={() => onRowClick?.(row.original)}
  className={onRowClick ? "cursor-pointer hover:bg-muted/50" : ""}
>
```
  </action>
  <verify>
1. Build succeeds: `bun run build` in packages/client
2. Navigate to /mijloace-fixe - page renders with header, filter bar, empty DataTable
3. "Adauga Mijloc Fix" button exists (navigation tested in later plan)
4. Filters work: type in search, select gestiune - URL params update
  </verify>
  <done>
- MijloaceFixe list page renders with DataTable
- Filters update URL and trigger refetch
- Row click is wired (navigation tested with routes)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add routing and navigation</name>
  <files>
    packages/client/src/main.tsx
    packages/client/src/App.tsx
  </files>
  <action>
**1. Update main.tsx** to add MijloaceFixe routes:

```typescript
import { MijloaceFixePage } from "./pages/MijloaceFixe";
// Placeholder components for now - will be created in later plans
const MijlocFixDetail = () => <div>Detail - coming soon</div>;
const MijlocFixEdit = () => <div>Edit/Create - coming soon</div>;

const router = createBrowserRouter([
  {
    path: "/",
    element: <App />,
    children: [
      // ... existing routes ...
      {
        path: "mijloace-fixe",
        children: [
          {
            index: true,
            element: <MijloaceFixePage />,
          },
          {
            path: "nou",
            element: <MijlocFixEdit />,
          },
          {
            path: ":id",
            element: <MijlocFixDetail />,
          },
          {
            path: ":id/edit",
            element: <MijlocFixEdit />,
          },
        ],
      },
    ],
  },
]);
```

**2. Update App.tsx** to add navigation link (if sidebar exists) or update menu:

Add "Mijloace Fixe" link pointing to /mijloace-fixe in the navigation.

Look at existing navigation pattern and follow it. Likely in App.tsx or a separate Nav component.
  </action>
  <verify>
1. Navigate to http://localhost:5173/mijloace-fixe - list page loads
2. Navigate to http://localhost:5173/mijloace-fixe/nou - placeholder shows
3. Navigate to http://localhost:5173/mijloace-fixe/1 - placeholder shows
4. Click "Adauga Mijloc Fix" button - navigates to /mijloace-fixe/nou
5. Navigation link appears in menu/sidebar
  </verify>
  <done>
- Routes configured for list, create, detail, edit
- Navigation link added to menu
- URL navigation works correctly
  </done>
</task>

</tasks>

<verification>
1. http://localhost:5173/mijloace-fixe shows asset list page
2. Filters update URL and refetch data
3. Row click navigates to detail page URL
4. "Adauga Mijloc Fix" navigates to /mijloace-fixe/nou
5. Navigation menu includes Mijloace Fixe link
</verification>

<success_criteria>
- Asset list page displays at /mijloace-fixe
- Filtering by gestiune, stare, and text search works
- URL params sync with filter state
- Row click navigation ready (to placeholder)
- Navigation in app menu
</success_criteria>

<output>
After completion, create `.planning/phases/03-mijloace-fixe-core/03-04-SUMMARY.md`
</output>
