---
phase: 03-mijloace-fixe-core
plan: 06
type: execute
wave: 5
depends_on: ["03-02", "03-05"]
files_modified:
  - packages/client/src/pages/MijlocFixDetail.tsx
  - packages/client/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "User can view complete asset details at /mijloace-fixe/:id"
    - "Detail page shows all asset data organized in sections"
    - "Classification info shows HG 2139 details (grupa, durata min/max)"
    - "Edit button navigates to edit page"
    - "All related data displayed (gestiune, loc folosinta, cont, sursa)"
  artifacts:
    - path: "packages/client/src/pages/MijlocFixDetail.tsx"
      provides: "Asset detail view page"
      min_lines: 100
  key_links:
    - from: "MijlocFixDetail.tsx"
      to: "/mijloace-fixe/:id"
      via: "api.get for asset data"
      pattern: "api\\.get.*mijloace-fixe"
    - from: "MijlocFixDetail.tsx"
      to: "/mijloace-fixe/:id/edit"
      via: "navigate on edit button click"
      pattern: "navigate.*edit"
---

<objective>
Create the MijlocFix detail page showing complete asset information in organized sections.

Purpose: Implements MF-03 (Vizualizare detalii) - users can view all asset data.
Output: Detail page with sections for identification, document, accounting, and depreciation data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-mijloace-fixe-core/03-CONTEXT.md
@.planning/phases/03-mijloace-fixe-core/03-RESEARCH.md
@packages/shared/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create MijlocFixDetail page</name>
  <files>
    packages/client/src/pages/MijlocFixDetail.tsx
    packages/client/src/main.tsx
  </files>
  <action>
**1. Create MijlocFixDetail.tsx** at packages/client/src/pages/:

```typescript
import { useState, useEffect } from "react";
import { useParams, useNavigate } from "react-router-dom";
import type { MijlocFix } from "shared";
import { api } from "@/lib/api";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Separator } from "@/components/ui/separator";
import { StareBadge } from "@/components/mijloace-fixe/StareBadge";
import { ArrowLeft, Pencil } from "lucide-react";

export function MijlocFixDetail() {
  const { id } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const [mijlocFix, setMijlocFix] = useState<MijlocFix | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    if (!id) return;

    setIsLoading(true);
    api.get<MijlocFix>(`/mijloace-fixe/${id}`).then((res) => {
      if (res.success && res.data) {
        setMijlocFix(res.data);
      } else {
        setError(res.message || "Eroare la incarcarea datelor");
      }
      setIsLoading(false);
    });
  }, [id]);

  if (isLoading) {
    return (
      <div className="flex items-center justify-center p-8">
        <div className="text-muted-foreground">Se incarca...</div>
      </div>
    );
  }

  if (error || !mijlocFix) {
    return (
      <div className="flex flex-col items-center justify-center p-8 gap-4">
        <div className="text-destructive">{error || "Mijlocul fix nu a fost gasit"}</div>
        <Button variant="outline" onClick={() => navigate("/mijloace-fixe")}>
          Inapoi la lista
        </Button>
      </div>
    );
  }

  const formatCurrency = (value: string) => {
    return parseFloat(value).toLocaleString("ro-RO", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    }) + " RON";
  };

  const formatDate = (dateStr?: string) => {
    if (!dateStr) return "-";
    return new Date(dateStr).toLocaleDateString("ro-RO");
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-4">
          <Button variant="ghost" size="icon" onClick={() => navigate("/mijloace-fixe")}>
            <ArrowLeft className="h-4 w-4" />
          </Button>
          <div>
            <div className="flex items-center gap-3">
              <h1 className="text-2xl font-bold">{mijlocFix.denumire}</h1>
              <StareBadge stare={mijlocFix.stare} />
            </div>
            <p className="text-muted-foreground font-mono">{mijlocFix.numarInventar}</p>
          </div>
        </div>
        <Button onClick={() => navigate(`/mijloace-fixe/${id}/edit`)}>
          <Pencil className="mr-2 h-4 w-4" />
          Editeaza
        </Button>
      </div>

      {/* Section: Date Identificare */}
      <Card>
        <CardHeader>
          <CardTitle>Date Identificare</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailField label="Numar Inventar" value={mijlocFix.numarInventar} mono />
          <DetailField label="Denumire" value={mijlocFix.denumire} />
          {mijlocFix.descriere && (
            <div className="md:col-span-2">
              <DetailField label="Descriere" value={mijlocFix.descriere} />
            </div>
          )}
        </CardContent>
      </Card>

      {/* Section: Clasificare HG 2139/2004 */}
      <Card>
        <CardHeader>
          <CardTitle>Clasificare HG 2139/2004</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailField label="Cod Clasificare" value={mijlocFix.clasificareCod} mono />
          <DetailField label="Grupa" value={mijlocFix.clasificare?.grupa || "-"} />
          {mijlocFix.clasificare && (
            <>
              <div className="md:col-span-2">
                <DetailField label="Denumire Clasificare" value={mijlocFix.clasificare.denumire} />
              </div>
              <DetailField
                label="Durata Normala (HG 2139)"
                value={`${mijlocFix.clasificare.durataNormalaMin} - ${mijlocFix.clasificare.durataNormalaMax} ani`}
              />
            </>
          )}
        </CardContent>
      </Card>

      {/* Section: Document Intrare */}
      <Card>
        <CardHeader>
          <CardTitle>Document Intrare</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailField label="Tip Document" value={mijlocFix.tipDocument?.denumire || "-"} />
          <DetailField label="Numar Document" value={mijlocFix.documentAchizitie || "-"} />
          <DetailField label="Furnizor" value={mijlocFix.furnizor || "-"} />
        </CardContent>
      </Card>

      {/* Section: Date Contabile */}
      <Card>
        <CardHeader>
          <CardTitle>Date Contabile</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailField
            label="Gestiune"
            value={mijlocFix.gestiune ? `${mijlocFix.gestiune.cod} - ${mijlocFix.gestiune.denumire}` : "-"}
          />
          <DetailField
            label="Loc Folosinta"
            value={mijlocFix.locFolosinta?.denumire || "-"}
          />
          <DetailField
            label="Cont"
            value={mijlocFix.cont ? `${mijlocFix.cont.simbol} - ${mijlocFix.cont.denumire}` : "-"}
          />
          <DetailField
            label="Sursa Finantare"
            value={mijlocFix.sursaFinantare?.denumire || "-"}
          />
        </CardContent>
      </Card>

      {/* Section: Amortizare */}
      <Card>
        <CardHeader>
          <CardTitle>Amortizare</CardTitle>
        </CardHeader>
        <CardContent className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <DetailField label="Valoare Inventar" value={formatCurrency(mijlocFix.valoareInventar)} />
          <DetailField label="Valoare Amortizata" value={formatCurrency(mijlocFix.valoareAmortizata)} />
          <DetailField label="Valoare Ramasa" value={formatCurrency(mijlocFix.valoareRamasa)} />
          <DetailField label="Data Achizitie" value={formatDate(mijlocFix.dataAchizitie)} />
          <DetailField label="Durata Normala" value={`${mijlocFix.durataNormala} luni`} />
          <DetailField
            label="Amortizabil"
            value={mijlocFix.eAmortizabil === false ? "Nu" : "Da"}
          />
        </CardContent>
      </Card>
    </div>
  );
}

// Helper component for consistent field display
function DetailField({
  label,
  value,
  mono = false,
}: {
  label: string;
  value: string;
  mono?: boolean;
}) {
  return (
    <div>
      <dt className="text-sm text-muted-foreground">{label}</dt>
      <dd className={`text-sm font-medium ${mono ? "font-mono" : ""}`}>
        {value}
      </dd>
    </div>
  );
}
```

**2. Update main.tsx** to use the real component:

Replace the placeholder:

```typescript
import { MijlocFixDetail } from "./pages/MijlocFixDetail";

// In router config:
// path: ":id" -> element: <MijlocFixDetail />
```
  </action>
  <verify>
1. Create an asset via the form first
2. Navigate to /mijloace-fixe/{id} - detail page loads
3. All sections display: Identificare, Clasificare, Document, Contabile, Amortizare
4. Related data shows names not IDs (gestiune name, loc name, etc.)
5. Classification shows HG 2139 range
6. Edit button navigates to /mijloace-fixe/{id}/edit
7. Back arrow returns to list
  </verify>
  <done>
- Detail page loads asset with all relations
- Sections organized logically
- HG 2139 classification details shown
- Edit button works
- Currency and date formatting correct
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete MijloaceFixe CRUD functionality:
- List page with filtering (gestiune, stare, text search)
- Create form with multi-section layout and classification picker
- Detail page with all asset information
- Edit form pre-filled with existing data
- Unique numar inventar validation
  </what-built>
  <how-to-verify>
1. Start the application: `bun run dev` from project root
2. Navigate to http://localhost:5173/mijloace-fixe

**Test MF-02 (List with filtering):**
3. Verify empty state message shows
4. Click "Adauga Mijloc Fix" button

**Test MF-01 (Registration), MF-05 (Unique validation), MF-06 (Classification):**
5. Fill out the form:
   - Nr. Inventar: MF-TEST-001
   - Denumire: Calculator Test HP
   - Click classification picker, search "calc", select a result
   - Verify durata normala auto-fills
   - Select a gestiune
   - Enter valoare: 5000
   - Select data achizitie: today
6. Submit - should create and redirect to list

**Test duplicate validation:**
7. Try creating another asset with same MF-TEST-001
8. Verify error "Numarul de inventar exista deja" appears

**Test MF-02 (Filtering):**
9. Create 2-3 more assets with different gestiuni
10. Use gestiune filter - list filters correctly
11. Use text search - finds by nr inventar and denumire

**Test MF-03 (Detail view):**
12. Click on a row in the list
13. Verify detail page shows all sections
14. Verify classification shows HG 2139 range

**Test MF-04 (Edit):**
15. Click "Editeaza" button
16. Change denumire, submit
17. Verify change persisted on detail page

Expected outcomes:
- All 6 requirements (MF-01 through MF-06) functional
- Forms validate properly with Romanian error messages
- Navigation flows work correctly
- Data persists correctly
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 3, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Detail page shows all asset data with correct formatting
2. Edit button navigates to edit form
3. All related data displayed (not just IDs)
4. Classification section shows HG 2139 details
5. Back navigation works
6. Complete CRUD flow verified by human
</verification>

<success_criteria>
- Detail page displays complete asset information
- Sections organized: Identificare, Clasificare, Document, Contabile, Amortizare
- Related entities show names not IDs
- Edit navigation works
- Phase 3 requirements MF-01 through MF-06 all verified
</success_criteria>

<output>
After completion, create `.planning/phases/03-mijloace-fixe-core/03-06-SUMMARY.md`
</output>
