---
phase: 03-mijloace-fixe-core
plan: 03
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - packages/client/src/components/mijloace-fixe/ClasificarePicker.tsx
  - packages/client/src/components/mijloace-fixe/StareBadge.tsx
  - packages/client/src/components/mijloace-fixe/MijlocFixFilters.tsx
  - packages/client/src/hooks/useDebounce.ts
autonomous: true

must_haves:
  truths:
    - "ClasificarePicker opens modal with search, shows results from API"
    - "User can select classification and picker closes with value"
    - "StareBadge shows correct color for each state"
    - "MijlocFixFilters renders filter controls"
  artifacts:
    - path: "packages/client/src/components/mijloace-fixe/ClasificarePicker.tsx"
      provides: "Searchable classification picker"
      min_lines: 80
    - path: "packages/client/src/components/mijloace-fixe/StareBadge.tsx"
      provides: "Status badge component"
    - path: "packages/client/src/components/mijloace-fixe/MijlocFixFilters.tsx"
      provides: "Filter toolbar for asset list"
      min_lines: 50
  key_links:
    - from: "ClasificarePicker.tsx"
      to: "/clasificari"
      via: "api.get with search param"
      pattern: "api\\.get.*clasificari.*search"
---

<objective>
Create reusable UI components for MijloaceFixe: classification picker modal, status badge, and filter toolbar.

Purpose: These components are used by both the list page and form - building them first enables parallel work.
Output: ClasificarePicker, StareBadge, MijlocFixFilters components ready for use.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-mijloace-fixe-core/03-CONTEXT.md
@.planning/phases/03-mijloace-fixe-core/03-RESEARCH.md
@packages/client/src/lib/api.ts
@packages/client/src/pages/Clasificari.tsx
@packages/shared/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDebounce hook and ClasificarePicker</name>
  <files>
    packages/client/src/hooks/useDebounce.ts
    packages/client/src/components/mijloace-fixe/ClasificarePicker.tsx
  </files>
  <action>
**1. Create useDebounce hook** at packages/client/src/hooks/useDebounce.ts:

```typescript
import { useState, useEffect } from "react";

export function useDebounce<T>(value: T, delay: number = 300): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(timer);
    };
  }, [value, delay]);

  return debouncedValue;
}
```

**2. Create ClasificarePicker** at packages/client/src/components/mijloace-fixe/ClasificarePicker.tsx:

Pattern: Use Command + Popover (Combobox pattern) from shadcn/ui.

Props:
```typescript
interface ClasificarePickerProps {
  value?: string;  // clasificare cod
  selectedClasificare?: Clasificare; // For displaying selected item details
  onSelect: (clasificare: Clasificare) => void;
  disabled?: boolean;
  error?: boolean;
}
```

Implementation:
- Popover with Button trigger showing selected cod or placeholder "Selecteaza clasificarea..."
- Command inside Popover with CommandInput
- Search on input change (debounced 300ms, min 2 chars)
- Fetch from API: `api.get<PaginatedResponse<Clasificare>>(\`/clasificari?search=\${query}&pageSize=20\`)`
- Show loading state
- Show "Nu s-au gasit clasificari" when no results
- Show "Introduceti cel putin 2 caractere" when search < 2 chars
- CommandItem for each result showing cod (font-mono) and denumire (truncated)
- On select: call onSelect, close popover, clear search

Icons: Use Check from lucide-react for selected state, ChevronsUpDown for trigger.

Visual details:
- PopoverContent width: w-[500px]
- Truncate denumire to max-w-[400px]
- Show grupa in parentheses after cod: "2.1.24 (II)"
  </action>
  <verify>
1. Create a test file or add to existing page temporarily:
```tsx
<ClasificarePicker
  value={undefined}
  onSelect={(c) => console.log('Selected:', c)}
/>
```

2. Open picker, type "calcu" - should show loading then results
3. Select an item - picker closes, onSelect called with full Clasificare object
4. With value set, trigger shows the cod
  </verify>
  <done>
- useDebounce hook works with configurable delay
- ClasificarePicker searches API with debounce
- Results display cod and denumire
- Selection works and closes picker
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StareBadge and MijlocFixFilters</name>
  <files>
    packages/client/src/components/mijloace-fixe/StareBadge.tsx
    packages/client/src/components/mijloace-fixe/MijlocFixFilters.tsx
  </files>
  <action>
**1. Create StareBadge** at packages/client/src/components/mijloace-fixe/StareBadge.tsx:

```typescript
import { Badge } from "@/components/ui/badge";

const stareConfig = {
  activ: {
    label: "Activ",
    className: "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200",
  },
  casare: {
    label: "In casare",
    className: "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200",
  },
  declasare: {
    label: "Declasat",
    className: "bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200",
  },
  transfer: {
    label: "Transfer",
    className: "bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200",
  },
  casat: {
    label: "Casat",
    className: "bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400",
  },
} as const;

type Stare = keyof typeof stareConfig;

interface StareBadgeProps {
  stare: string;
}

export function StareBadge({ stare }: StareBadgeProps) {
  const config = stareConfig[stare as Stare] || {
    label: stare,
    className: "bg-gray-100 text-gray-600",
  };

  return (
    <Badge variant="outline" className={config.className}>
      {config.label}
    </Badge>
  );
}
```

**2. Create MijlocFixFilters** at packages/client/src/components/mijloace-fixe/MijlocFixFilters.tsx:

Props:
```typescript
interface MijlocFixFiltersProps {
  gestiuni: Gestiune[];
  filters: {
    search?: string;
    gestiuneId?: number;
    stare?: string;
  };
  onFiltersChange: (filters: MijlocFixFiltersProps['filters']) => void;
}
```

Implementation:
- Horizontal flex layout with gap-4, wrap on small screens
- Text search input with Search icon (lucide-react), placeholder "Cauta dupa nr. inventar sau denumire..."
- Gestiune Select dropdown with "Toate gestiunile" option
- Stare Select dropdown with options: Toate, Activ, Casat

Use shadcn Input for search, Select for dropdowns.

When gestiune changes, reset locFolosinta filter (if added later).

Sync state is controlled by parent - just call onFiltersChange with new values.
  </action>
  <verify>
1. Add StareBadge to a test:
```tsx
<StareBadge stare="activ" />
<StareBadge stare="casat" />
```
Badge shows correct color and label.

2. Add MijlocFixFilters to a test page with mock gestiuni:
```tsx
const [filters, setFilters] = useState({});
<MijlocFixFilters
  gestiuni={[{ id: 1, cod: "G1", denumire: "Gestiune 1", activ: true }]}
  filters={filters}
  onFiltersChange={setFilters}
/>
```
Typing in search and changing dropdowns updates filters state.

3. Build succeeds: `bun run build` in packages/client
  </verify>
  <done>
- StareBadge renders correct color for each state
- MijlocFixFilters renders search input and Select dropdowns
- Filter changes propagate to parent via onFiltersChange
  </done>
</task>

</tasks>

<verification>
1. All component files exist in packages/client/src/components/mijloace-fixe/
2. useDebounce hook exists in packages/client/src/hooks/
3. Build succeeds without TypeScript errors
4. Components render correctly when imported
</verification>

<success_criteria>
- ClasificarePicker searches API and allows selection
- StareBadge displays correct colors for all states
- MijlocFixFilters provides search and dropdown filtering
- All components follow existing code patterns
</success_criteria>

<output>
After completion, create `.planning/phases/03-mijloace-fixe-core/03-03-SUMMARY.md`
</output>
