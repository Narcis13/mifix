---
phase: 03-mijloace-fixe-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - packages/client/src/components/ui/badge.tsx
  - packages/client/src/components/ui/command.tsx
  - packages/client/src/components/ui/popover.tsx
  - packages/client/src/components/ui/card.tsx
  - packages/client/src/components/ui/separator.tsx
  - packages/server/src/db/schema.ts
  - packages/server/src/validation/schemas.ts
  - packages/server/src/routes/tipuri-document.ts
  - packages/server/src/index.ts
  - packages/shared/src/types/index.ts
autonomous: true

must_haves:
  truths:
    - "shadcn Badge, Command, Popover, Card, Separator components are available"
    - "tipuriDocument table exists with seeded values (NIR, PV, Donatie, Achizitie)"
    - "MijlocFix schema has eAmortizabil field"
    - "API endpoint GET /tipuri-document returns document types"
  artifacts:
    - path: "packages/client/src/components/ui/badge.tsx"
      provides: "Badge component for status display"
    - path: "packages/client/src/components/ui/command.tsx"
      provides: "Command palette for classification picker"
    - path: "packages/server/src/db/schema.ts"
      provides: "tipuriDocument table, eAmortizabil on mijloaceFixe"
      contains: "tipuriDocument"
    - path: "packages/server/src/routes/tipuri-document.ts"
      provides: "TipDocument CRUD routes"
      exports: ["tipuriDocumentRoutes"]
  key_links:
    - from: "packages/server/src/index.ts"
      to: "/tipuri-document"
      via: "route registration"
      pattern: "tipuriDocumentRoutes"
---

<objective>
Install required UI components and add TipDocument nomenclator with schema updates for MijlocFix.

Purpose: Foundation for Phase 3 - UI components needed for forms and lists, plus the TipDocument nomenclator that CONTEXT.md identified as a prerequisite.
Output: shadcn components installed, tipuriDocument table with API, MijlocFix schema ready with eAmortizabil field.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-mijloace-fixe-core/03-CONTEXT.md
@.planning/phases/03-mijloace-fixe-core/03-RESEARCH.md
@packages/server/src/db/schema.ts
@packages/server/src/validation/schemas.ts
@packages/server/src/index.ts
@packages/shared/src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn/ui components</name>
  <files>
    packages/client/src/components/ui/badge.tsx
    packages/client/src/components/ui/command.tsx
    packages/client/src/components/ui/popover.tsx
    packages/client/src/components/ui/card.tsx
    packages/client/src/components/ui/separator.tsx
  </files>
  <action>
Run from packages/client directory:

```bash
bunx shadcn@latest add badge command popover card separator
```

This installs:
- Badge: Status indicator (Activ/Casat) for asset list
- Command: Searchable picker for classification modal
- Popover: Picker container for classification modal
- Card: Section containers for form layout
- Separator: Visual dividers for form sections

Verify each component file is created in packages/client/src/components/ui/
  </action>
  <verify>
Files exist:
- packages/client/src/components/ui/badge.tsx
- packages/client/src/components/ui/command.tsx
- packages/client/src/components/ui/popover.tsx
- packages/client/src/components/ui/card.tsx
- packages/client/src/components/ui/separator.tsx

Run `bun run build` from packages/client to verify no TypeScript errors.
  </verify>
  <done>All 5 shadcn components installed and build succeeds</done>
</task>

<task type="auto">
  <name>Task 2: Add TipDocument nomenclator (schema + seed + API)</name>
  <files>
    packages/server/src/db/schema.ts
    packages/server/src/validation/schemas.ts
    packages/server/src/routes/tipuri-document.ts
    packages/server/src/index.ts
    packages/shared/src/types/index.ts
  </files>
  <action>
1. **Update schema.ts** - Add tipuriDocument table BEFORE mijloaceFixe table:

```typescript
// ============================================================================
// X. Tipuri Document - Document Types for Asset Acquisition
// ============================================================================
export const tipuriDocument = mysqlTable("tipuri_document", {
  id: int("id").primaryKey().autoincrement(),
  cod: varchar("cod", { length: 20 }).notNull().unique(),
  denumire: varchar("denumire", { length: 100 }).notNull(),
  activ: boolean("activ").default(true),
});
```

2. **Update mijloaceFixe table** - Add two new fields:
- `tipDocumentId: int("tip_document_id")` - reference to tipuriDocument
- `eAmortizabil: boolean("e_amortizabil").default(true)` - override depreciation

Add relation to tipuriDocument.

3. **Update shared types** - Add TipDocument interface:

```typescript
export interface TipDocument {
  id: number;
  cod: string;
  denumire: string;
  activ: boolean;
}
```

Update MijlocFix interface to include:
- `tipDocumentId?: number;`
- `tipDocument?: TipDocument;`
- `eAmortizabil: boolean;`

4. **Create validation schemas** - Add to schemas.ts:

```typescript
export const insertTipDocumentSchema = createInsertSchema(tipuriDocument, {
  cod: (schema) => schema.min(1, "Cod obligatoriu").max(20, "Cod maxim 20 caractere"),
  denumire: (schema) => schema.min(1, "Denumire obligatorie").max(100, "Denumire maxim 100 caractere"),
}).omit({ id: true });
```

5. **Create API route** - packages/server/src/routes/tipuri-document.ts:
- GET / - list all tipuri document ordered by cod
- GET /:id - get single by id
- POST / - create new (zValidator validation)
- PUT /:id - update existing

Follow exact patterns from gestiuni.ts.

6. **Register route** in index.ts:

```typescript
import { tipuriDocumentRoutes } from "./routes/tipuri-document";
app.route("/tipuri-document", tipuriDocumentRoutes);
```

7. **Push schema and seed** - Run:
```bash
cd packages/server
bunx drizzle-kit push
```

Then seed initial values via curl or direct insert:
- NIR (Nota Intrare Receptie)
- PV (Proces Verbal)
- Donatie
- Achizitie
- Transfer
  </action>
  <verify>
1. Run `bun run dev` from root - server starts without errors
2. `curl http://localhost:3000/tipuri-document` returns empty array or seeded data
3. Create a tip document:
   `curl -X POST http://localhost:3000/tipuri-document -H "Content-Type: application/json" -d '{"cod":"NIR","denumire":"Nota Intrare Receptie"}'`
   Returns 201 with created object
4. Verify schema with: `bunx drizzle-kit studio` - tipuri_document table exists with correct columns
5. mijloace_fixe table has tip_document_id and e_amortizabil columns
  </verify>
  <done>
- tipuriDocument table created with API
- MijlocFix schema has tipDocumentId and eAmortizabil fields
- At least NIR, PV, Donatie, Achizitie seeded
- API returns document types list
  </done>
</task>

</tasks>

<verification>
1. All 5 shadcn components exist in packages/client/src/components/ui/
2. `bun run build` succeeds in packages/client
3. Server starts without errors
4. GET /tipuri-document returns seeded document types
5. Database has tipuri_document and updated mijloace_fixe tables
</verification>

<success_criteria>
- shadcn Badge, Command, Popover, Card, Separator components installed
- TipDocument nomenclator with API functional
- MijlocFix schema extended with tipDocumentId and eAmortizabil
- Build and dev server both work
</success_criteria>

<output>
After completion, create `.planning/phases/03-mijloace-fixe-core/03-01-SUMMARY.md`
</output>
